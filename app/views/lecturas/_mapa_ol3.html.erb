    <style>
      .map {
        height: 400px;
        width: 100%;
      }
    </style>


<div id="map" class="map"></div>

<script type="text/javascript">
osm = new ol.layer.Tile({
    source: new ol.source.OSM()
  });

p = <%=raw a = @lecturas.select{|a| a.present? && a.lat.present?}.first; a.nil? ? [-54,-34] :  [a.lon, a.lat] %>;

var map = new ol.Map({
  controls: ol.control.defaults().extend([
    new ol.control.FullScreen(),
  ]),
  target: 'map',
  layers: [osm],
  view: new ol.View2D({
    center: ol.proj.transform(p, 'EPSG:4326', 'EPSG:3857'),
    zoom: 16  
  })
});
            
<%  @lecturas.select{|a| a.lat.present?}.each do |l| %>
      p = [ <%= l.lon %> , <%= l.lat %>];
      g = new ol.geom.Point( p ).transform('EPSG:4326', 'EPSG:3857');
      map.addOverlay(new ol.Overlay({
        position: ol.proj.transform(p, 'EPSG:4326', 'EPSG:3857'),
        element: $('<img src="/images/green-dot.png">')
            .css({marginTop: '-200%', marginLeft: '-50%', cursor: 'pointer'})
            .tooltip({title: '<%=l.direccion%>', trigger: 'hover'})
      }))
<% end %>

<%  @lecturas.select{|a| a.lectura_lat.present?}.each do |l| %>
      p = [ <%= l.letcura_lon %> , <%= l.lectura_lat %>];
      g = new ol.geom.Point( p ).transform('EPSG:4326', 'EPSG:3857');
      map.addOverlay(new ol.Overlay({
        position: ol.proj.transform(p, 'EPSG:4326', 'EPSG:3857'),
        element: $('<img src="/images/red-dot.png">')
            .css({marginTop: '-200%', marginLeft: '-50%', cursor: 'pointer'})
            .tooltip({title: '<%=l.direccion%>', trigger: 'hover'})
      }))
<% end %>

</script>